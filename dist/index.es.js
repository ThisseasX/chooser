var n=/^\{(?:\$(\d+?))?(?:#(.+?))?\}$/,e=function(e){return fp.isPlainObject(e)?function(e){return Object.entries(e).map((function(e){var t=e[0],f=e[1],i=n.exec(f)||[],u={when:t,ref:i[1],use:i[2],then:f};return fp.pickBy(fp.negate(fp.isUndefined),u)}),[])}(e):e},t=function(n){var t=n.input,f=n.choices,i=n.equalityFn;return fp.flow((function(n){return fp.set("choices",function(n){return fp.isFunction(n)?n():n}(n.choices),n)}),(function(n){return fp.set("input",function(n,e){return fp.isPlainObject(n)?fp.toString(e):e}(n.choices,n.input),n)}),(function(n){return fp.set("choices",e(n.choices),n)}),(function(n){return fp.set("equalityFn",function(n){return n&&fp.curryN(2,n)}(i),n)}),fp.values)({input:t,choices:f,equalityFn:i})},f=function(n,e,t,i){return void 0===t&&(t=fp.eq),fp.flow(fp.isUndefined(i)?fp.find((function(e){var f=e.when;return fp.isArray(f)?f.some(t(n)):t(n)(f)})):fp.constant(e[i]),fp.defaultTo({}),(function(i){return fp.isUndefined(i.ref)?fp.isUndefined(i.use)?i:f(i.use,e,t):f(n,e,t,i.ref)}))(e)};export default function(n,e,i){return function(u,r){return fp.flow(fp.spread(f),(function(n){return fp.isUndefined(n.eager)?fp.result("then",n):n.eager}),fp.defaultTo(e))(t({input:u,choices:n,equalityFn:r||i}))}}
